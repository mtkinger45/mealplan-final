// updated backend logic including improved PDF generation